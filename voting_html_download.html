<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Voting Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f6d55c 0%, #3caa3c 50%, #e74c3c 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .auth-container {
            max-width: 500px;
            margin: 60px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #f6d55c, #e74c3c);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.3);
            position: relative;
        }

        .logo::before {
            content: 'üó≥Ô∏è';
            font-size: 60px;
        }

        .org-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .org-subtitle {
            font-size: 16px;
            color: #718096;
            margin-bottom: 30px;
        }

        .dashboard {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #4a5568;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #f6d55c;
        }

        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #f6d55c 0%, #e74c3c 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #718096;
            margin-top: 10px;
        }

        .btn-danger {
            background: #e53e3e;
            width: auto;
            padding: 8px 16px;
            margin-left: 10px;
        }

        .btn-success {
            background: #3caa3c;
            width: auto;
            padding: 8px 16px;
            margin: 10px 5px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .role-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .admin {
            background: #fef5e7;
            color: #d69e2e;
        }

        .voter {
            background: #e6fffa;
            color: #319795;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 600;
            color: #718096;
            width: auto;
            transition: color 0.3s;
        }

        .tab.active {
            color: #e74c3c;
            border-bottom: 3px solid #e74c3c;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .candidate-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .candidate-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            position: relative;
        }

        .candidate-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .candidate-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .candidate-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .candidate-info {
            text-align: center;
        }

        .candidate-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .candidate-description {
            color: #718096;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .vote-btn {
            background: #3caa3c;
            padding: 10px 20px;
            width: auto;
            margin: 10px 5px;
        }

        .vote-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }

        .admin-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .edit-btn {
            background: #f6d55c;
            color: #333;
            width: auto;
            padding: 8px 16px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            width: auto;
            padding: 0;
            color: #718096;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: block;
            padding: 12px;
            background: #edf2f7;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background: #e2e8f0;
            border-color: #a0aec0;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .error-message {
            background: #fed7d7;
            color: #822727;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .voting-status {
            background: #fef5e7;
            color: #d69e2e;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
        }

        .admin-voting-blocked {
            background: #fed7d7;
            color: #822727;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            border: 2px solid #e53e3e;
        }

        .code-management {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #e2e8f0;
        }

        .generated-codes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .code-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            text-align: center;
            position: relative;
        }

        .code-text {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .code-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .code-unused {
            background: #c6f6d5;
            color: #22543d;
        }

        .code-used {
            background: #fed7d7;
            color: #822727;
        }

        .copy-btn {
            background: #f6d55c;
            color: #333;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 5px;
            width: auto;
        }

        @media (max-width: 768px) {
            .auth-container {
                max-width: 90%;
                margin: 40px auto;
                padding: 30px 25px;
            }
            
            .candidate-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .generated-codes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginContainer" class="auth-container">
            <div class="logo-container">
                <div class="logo"></div>
                <div class="org-title">VOTING FORMATUR</div>
                <div class="org-subtitle">PC IPM DEPOK BARAT</div>
            </div>
            
            <div class="form-group">
                <label for="username">Username/Kode Akses:</label>
                <input type="text" id="username" placeholder="Masukkan username atau kode akses">
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button onclick="login()">Login</button>
            <div id="loginMessage"></div>
            
            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0;">
                <h3 style="text-align: center; margin-bottom: 15px; color: #718096;">Demo Akun:</h3>
                <div style="background: #f7fafc; padding: 15px; border-radius: 8px; font-size: 14px;">
                    <strong>Admin:</strong> admin / admin123<br>
                    <strong>Voter:</strong> user1 / user123<br>
                    <strong>Code User:</strong> DEMO1234 / voter123
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard">
            <div class="header">
                <h1>Dashboard Voting</h1>
                <div class="user-info">
                    <span id="currentUser"></span>
                    <span id="userRole" class="role-badge"></span>
                    <button onclick="logout()" class="btn-secondary" style="width: auto; padding: 8px 16px;">Logout</button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('voting')">Voting</button>
                <button class="tab" id="adminTab" onclick="showTab('admin')" style="display: none;">Kelola Kandidat</button>
                <button class="tab" id="codeTab" onclick="showTab('codes')" style="display: none;">Kelola Kode Akses</button>
            </div>

            <!-- Voting Tab -->
            <div id="votingTab" class="tab-content active">
                <div id="votingStatus"></div>
                <div id="candidateList" class="candidate-grid"></div>
            </div>

            <!-- Admin Tab -->
            <div id="adminTab-content" class="tab-content">
                <button onclick="showAddCandidateModal()" style="width: auto; padding: 12px 24px; margin-bottom: 20px;">Tambah Kandidat</button>
                <div id="adminCandidateList" class="candidate-grid"></div>
            </div>

            <!-- Code Management Tab -->
            <div id="codesTab-content" class="tab-content">
                <div class="code-management">
                    <h3 style="margin-bottom: 20px; color: #2d3748;">Kelola Kode Akses Voter</h3>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                        <input type="number" id="codeCount" placeholder="Jumlah kode" min="1" max="50" value="5" 
                               style="width: 150px; flex: none;">
                        <button onclick="generateCodes()" class="btn-success">Generate Kode</button>
                        <button onclick="resetAllCodes()" class="btn-danger" style="margin-left: 0;">Reset Semua</button>
                    </div>
                    <div id="codeStats" style="background: #e6fffa; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>
                </div>
                <div id="generatedCodes" class="generated-codes"></div>
            </div>
        </div>
    </div>

    <!-- Modal untuk tambah/edit kandidat -->
    <div id="candidateModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeCandidateModal()">&times;</button>
            <h2 id="modalTitle">Tambah Kandidat</h2>
            <div class="form-group">
                <label for="candidateName">Nama Kandidat:</label>
                <input type="text" id="candidateName" placeholder="Masukkan nama kandidat">
            </div>
            <div class="form-group">
                <label for="candidateDescription">Deskripsi/Visi Misi:</label>
                <textarea id="candidateDescription" rows="4" placeholder="Masukkan deskripsi, visi misi kandidat"></textarea>
            </div>
            <div class="form-group">
                <label>Foto Kandidat:</label>
                <div class="file-input-wrapper">
                    <input type="file" id="candidatePhoto" accept="image/*" onchange="handlePhotoUpload(event)">
                    <label for="candidatePhoto" class="file-input-label">
                        <span id="photoLabel">Klik untuk upload foto</span>
                    </label>
                </div>
                <div id="photoPreview" style="margin-top: 15px; text-align: center;"></div>
            </div>
            <button onclick="saveCandidate()">Simpan</button>
            <button onclick="closeCandidateModal()" class="btn-secondary">Batal</button>
        </div>
    </div>

    <script>
        // Data storage (in real app, this would be in a database)
        let users = {
            'admin': { password: 'admin123', role: 'admin', name: 'Administrator' },
            'user1': { password: 'user123', role: 'voter', name: 'User Satu' },
            'user2': { password: 'user123', role: 'voter', name: 'User Dua' }
        };

        let candidates = [
            {
                id: 1,
                name: 'Kandidat A',
                description: 'Visi: Membangun masa depan yang lebih baik dengan fokus pada pendidikan dan ekonomi rakyat.',
                photo: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"%3E%3Ccircle cx="60" cy="60" r="60" fill="%23e2e8f0"/%3E%3Ccircle cx="60" cy="45" r="20" fill="%234a5568"/%3E%3Cpath d="M20 100 Q60 80 100 100 V120 H20 Z" fill="%234a5568"/%3E%3C/svg%3E',
                votes: 0
            },
            {
                id: 2,
                name: 'Kandidat B',
                description: 'Visi: Menciptakan kesempatan kerja dan meningkatkan kesejahteraan masyarakat melalui inovasi teknologi.',
                photo: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"%3E%3Ccircle cx="60" cy="60" r="60" fill="%23e2e8f0"/%3E%3Ccircle cx="60" cy="45" r="20" fill="%233caa3c"/%3E%3Cpath d="M20 100 Q60 80 100 100 V120 H20 Z" fill="%233caa3c"/%3E%3C/svg%3E',
                votes: 0
            }
        ];

        let currentUser = null;
        let userVotes = {}; // Track who voted for whom
        let editingCandidate = null;
        let accessCodes = {}; // Store generated access codes

        function generateRandomCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return code;
        }

        function generateCodes() {
            const count = parseInt(document.getElementById('codeCount').value) || 5;
            
            if (count < 1 || count > 50) {
                alert('Jumlah kode harus antara 1-50!');
                return;
            }

            for (let i = 0; i < count; i++) {
                let code;
                do {
                    code = generateRandomCode();
                } while (accessCodes[code]); // Ensure unique codes

                accessCodes[code] = {
                    used: false,
                    usedBy: null,
                    createdAt: new Date().toISOString()
                };
            }

            displayCodes();
            updateCodeStats();
        }

        function displayCodes() {
            const container = document.getElementById('generatedCodes');
            const codes = Object.keys(accessCodes);
            
            container.innerHTML = codes.map(code => `
                <div class="code-card">
                    <div class="code-text">${code}</div>
                    <div class="code-status ${accessCodes[code].used ? 'code-used' : 'code-unused'}">
                        ${accessCodes[code].used ? `Digunakan: ${accessCodes[code].usedBy}` : 'Belum Digunakan'}
                    </div>
                    <button class="copy-btn" onclick="copyCode('${code}')">Copy</button>
                    <button class="btn-danger copy-btn" onclick="deleteCode('${code}')" style="margin-left: 5px;">Hapus</button>
                </div>
            `).join('');
        }

        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                alert(`Kode ${code} berhasil dicopy!`);
            });
        }

        function deleteCode(code) {
            if (confirm(`Hapus kode ${code}?`)) {
                delete accessCodes[code];
                displayCodes();
                updateCodeStats();
            }
        }

        function resetAllCodes() {
            if (confirm('Reset semua kode akses? Semua kode akan dihapus!')) {
                accessCodes = {};
                displayCodes();
                updateCodeStats();
            }
        }

        function updateCodeStats() {
            const total = Object.keys(accessCodes).length;
            const used = Object.values(accessCodes).filter(code => code.used).length;
            const unused = total - used;
            
            document.getElementById('codeStats').innerHTML = `
                <strong>Statistik Kode:</strong> 
                Total: ${total} | 
                Digunakan: ${used} | 
                Tersisa: ${unused}
            `;
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('loginMessage');

            // Check regular users
            if (users[username] && users[username].password === password) {
                currentUser = {
                    username: username,
                    ...users[username]
                };
                
                showDashboard();
                messageDiv.innerHTML = '';
                return;
            }

            // Check access codes
            if (accessCodes[username]) {
                if (accessCodes[username].used) {
                    messageDiv.innerHTML = '<div class="error-message">Kode akses sudah digunakan!</div>';
                    return;
                }

                if (password === 'voter123') { // Default password for code users
                    accessCodes[username].used = true;
                    accessCodes[username].usedBy = `User-${username.slice(-4)}`;
                    
                    currentUser = {
                        username: username,
                        role: 'voter',
                        name: `Voter ${username.slice(-4)}`,
                        isCodeUser: true
                    };
                    
                    showDashboard();
                    messageDiv.innerHTML = '';
                    return;
                }
            }

            messageDiv.innerHTML = '<div class="error-message">Username/kode atau password salah!</div>';
        }

        function showDashboard() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            document.getElementById('currentUser').textContent = currentUser.name;
            document.getElementById('userRole').textContent = currentUser.role;
            document.getElementById('userRole').className = `role-badge ${currentUser.role}`;
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminTab').style.display = 'block';
                document.getElementById('codeTab').style.display = 'block';
                updateCodeStats();
            }
            
            loadCandidates();
            updateVotingStatus();
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('adminTab').style.display = 'none';
            document.getElementById('codeTab').style.display = 'none';
            showTab('voting');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tabName === 'voting') {
                document.querySelector('.tab').classList.add('active');
                document.getElementById('votingTab').classList.add('active');
                loadCandidates();
            } else if (tabName === 'admin') {
                document.getElementById('adminTab').classList.add('active');
                document.getElementById('adminTab-content').classList.add('active');
                loadAdminCandidates();
            } else if (tabName === 'codes') {
                document.getElementById('codeTab').classList.add('active');
                document.getElementById('codesTab-content').classList.add('active');
                displayCodes();
                updateCodeStats();
            }
        }

        function loadCandidates() {
            const container = document.getElementById('candidateList');
            
            // Block admin from voting
            if (currentUser.role === 'admin') {
                container.innerHTML = `
                    <div class="admin-voting-blocked">
                        <h3>üö´ Admin Tidak Dapat Melakukan Voting</h3>
                        <p>Sebagai administrator, Anda hanya dapat mengelola kandidat dan melihat hasil voting, namun tidak dapat memberikan suara.</p>
                        <p style="margin-top: 15px; font-size: 14px;">Gunakan akun voter atau kode akses untuk melakukan voting.</p>
                    </div>
                `;
                
                // Show results for admin
                const resultsHtml = candidates.map(candidate => `
                    <div class="candidate-card">
                        <div class="candidate-photo">
                            <img src="${candidate.photo}" alt="${candidate.name}" />
                        </div>
                        <div class="candidate-info">
                            <div class="candidate-name">${candidate.name}</div>
                            <div class="candidate-description">${candidate.description}</div>
                            <div style="margin-top: 15px; padding: 10px; background: #f6d55c; border-radius: 8px; font-weight: 600; color: #333;">
                                üìä Total Votes: ${candidate.votes}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML += `<div style="margin-top: 30px;"><h3 style="text-align: center; color: #2d3748; margin-bottom: 20px;">Hasil Voting Sementara</h3><div class="candidate-grid">${resultsHtml}</div></div>`;
                return;
            }
            
            // Normal voting interface for voters
            const hasVoted = userVotes[currentUser.username];
            
            container.innerHTML = candidates.map(candidate => `
                <div class="candidate-card">
                    <div class="candidate-photo">
                        <img src="${candidate.photo}" alt="${candidate.name}" />
                    </div>
                    <div class="candidate-info">
                        <div class="candidate-name">${candidate.name}</div>
                        <div class="candidate-description">${candidate.description}</div>
                        <button class="vote-btn" 
                                onclick="vote(${candidate.id})" 
                                ${hasVoted ? 'disabled' : ''}>
                            ${hasVoted === candidate.id ? 'Sudah Dipilih ‚úì' : 'Pilih Kandidat'}
                        </button>
                        <div style="margin-top: 10px; font-weight: 600; color: #e74c3c;">
                            Votes: ${candidate.votes}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadAdminCandidates() {
            const container = document.getElementById('adminCandidateList');
            
            container.innerHTML = candidates.map(candidate => `
                <div class="candidate-card">
                    <div class="candidate-photo">
                        <img src="${candidate.photo}" alt="${candidate.name}" />
                    </div>
                    <div class="candidate-info">
                        <div class="candidate-name">${candidate.name}</div>
                        <div class="candidate-description">${candidate.description}</div>
                        <div style="margin-top: 10px; font-weight: 600; color: #e74c3c;">
                            Total Votes: ${candidate.votes}
                        </div>
                        <div class="admin-actions">
                            <button class="edit-btn" onclick="editCandidate(${candidate.id})">Edit</button>
                            <button class="btn-danger" onclick="deleteCandidate(${candidate.id})">Hapus</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function vote(candidateId) {
            // Double check - admin cannot vote
            if (currentUser.role === 'admin') {
                alert('Admin tidak dapat melakukan voting!');
                return;
            }

            if (userVotes[currentUser.username]) {
                alert('Anda sudah melakukan voting!');
                return;
            }

            const candidate = candidates.find(c => c.id === candidateId);
            if (candidate) {
                candidate.votes++;
                userVotes[currentUser.username] = candidateId;
                
                document.getElementById('votingStatus').innerHTML = 
                    `<div class="success-message">Terima kasih! Anda telah memilih: ${candidate.name}</div>`;
                
                loadCandidates();
                updateVotingStatus();
            }
        }

        function updateVotingStatus() {
            const statusDiv = document.getElementById('votingStatus');
            
            // Admin status
            if (currentUser.role === 'admin') {
                statusDiv.innerHTML = 
                    `<div class="admin-voting-blocked">Administrator - Anda dapat melihat hasil tetapi tidak dapat voting</div>`;
                return;
            }
            
            // Voter status
            const hasVoted = userVotes[currentUser.username];
            if (hasVoted) {
                const candidate = candidates.find(c => c.id === hasVoted);
                statusDiv.innerHTML = 
                    `<div class="voting-status">‚úÖ Anda sudah memilih: ${candidate.name}</div>`;
            } else {
                statusDiv.innerHTML = 
                    `<div class="voting-status">üó≥Ô∏è Silakan pilih kandidat favorit Anda</div>`;
            }
        }

        function showAddCandidateModal() {
            editingCandidate = null;
            document.getElementById('modalTitle').textContent = 'Tambah Kandidat';
            document.getElementById('candidateName').value = '';
            document.getElementById('candidateDescription').value = '';
            document.getElementById('candidatePhoto').value = '';
            document.getElementById('photoLabel').textContent = 'Klik untuk upload foto';
            document.getElementById('photoPreview').innerHTML = '';
            document.getElementById('candidateModal').style.display = 'block';
        }

        function editCandidate(id) {
            editingCandidate = candidates.find(c => c.id === id);
            document.getElementById('modalTitle').textContent = 'Edit Kandidat';
            document.getElementById('candidateName').value = editingCandidate.name;
            document.getElementById('candidateDescription').value = editingCandidate.description;
            
            if (editingCandidate.photo) {
                document.getElementById('photoPreview').innerHTML = 
                    `<img src="${editingCandidate.photo}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%;" />`;
            }
            
            document.getElementById('candidateModal').style.display = 'block';
        }

        function closeCandidateModal() {
            document.getElementById('candidateModal').style.display = 'none';
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photoPreview');
                    preview.innerHTML = 
                        `<img src="${e.target.result}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%;" />`;
                    document.getElementById('photoLabel').textContent = file.name;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveCandidate() {
            const name = document.getElementById('candidateName').value;
            const description = document.getElementById('candidateDescription').value;
            const photoFile = document.getElementById('candidatePhoto').files[0];
            
            if (!name.trim()) {
                alert('Nama kandidat harus diisi!');
                return;
            }

            if (editingCandidate) {
                // Update existing candidate
                editingCandidate.name = name;
                editingCandidate.description = description;
                
                if (photoFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        editingCandidate.photo = e.target.result;
                        closeCandidateModal();
                        loadAdminCandidates();
                        loadCandidates();
                    };
                    reader.readAsDataURL(photoFile);
                } else {
                    closeCandidateModal();
                    loadAdminCandidates();
                    loadCandidates();
                }
            } else {
                // Add new candidate
                const newCandidate = {
                    id: Math.max(...candidates.map(c => c.id)) + 1,
                    name: name,
                    description: description,
                    photo: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"%3E%3Ccircle cx="60" cy="60" r="60" fill="%23e2e8f0"/%3E%3Ccircle cx="60" cy="45" r="20" fill="%23718096"/%3E%3Cpath d="M20 100 Q60 80 100 100 V120 H20 Z" fill="%23718096"/%3E%3C/svg%3E',
                    votes: 0
                };

                if (photoFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        newCandidate.photo = e.target.result;
                        candidates.push(newCandidate);
                        closeCandidateModal();
                        loadAdminCandidates();
                        loadCandidates();
                    };
                    reader.readAsDataURL(photoFile);
                } else {
                    candidates.push(newCandidate);
                    closeCandidateModal();
                    loadAdminCandidates();
                    loadCandidates();
                }
            }
        }

        function deleteCandidate(id) {
            if (confirm('Apakah Anda yakin ingin menghapus kandidat ini?')) {
                candidates = candidates.filter(c => c.id !== id);
                
                // Remove votes for deleted candidate
                Object.keys(userVotes).forEach(user => {
                    if (userVotes[user] === id) {
                        delete userVotes[user];
                    }
                });
                
                loadAdminCandidates();
                loadCandidates();
                updateVotingStatus();
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('candidateModal');
            if (event.target === modal) {
                closeCandidateModal();
            }
        }

        // Initialize with some demo codes for testing
        setTimeout(() => {
            accessCodes['DEMO1234'] = { used: false, usedBy: null, createdAt: new Date().toISOString() };
            accessCodes['TEST5678'] = { used: false, usedBy: null, createdAt: new Date().toISOString() };
        }, 100);
    </script>
</body>
</html>